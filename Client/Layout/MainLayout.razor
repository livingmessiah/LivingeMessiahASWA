@using Client.Layout.Navigation
@using Client.Layout.Login
@using Client.Enums
@using Client.Services

@inherits LayoutComponentBase
@inject ProfileService ProfileService
@implements IDisposable

<div class="@MediaQuery.Xs.DivClass">

	<div class="d-flex bg-warning-subtle">
		<div class="p-1">
			<HomeButton MediaQuery="@MediaQuery.Xs" DarkMode="@_preferences.DarkMode" />
		</div>

		<div class="p-1 flex-grow-1">
			<SearchForm />
		</div>
		<div class="">
			<ToggleCollapseXs>
				<AnchorButtons />
			</ToggleCollapseXs>
		</div>
	</div>

</div>

<div class="@MediaQuery.Sm.DivClass">
	<div class="d-flex bg-warning-subtle">
		<div class="p-1">
			<HomeButton MediaQuery="@MediaQuery.Sm" DarkMode="@_preferences.DarkMode" />
		</div>
		<div class="p-1 flex-grow-1">
			<SearchForm />
		</div>
		<div class="p-1">
			<AnchorButtonsSmMdLgXl MediaQuery="@MediaQuery.Sm" />
		</div>
	</div>
</div>

<div class="@MediaQuery.MdOrLgOrXl.DivClass">
	<div class="d-flex bg-warning-subtle">
		<div class="p-1">
			<HomeButton MediaQuery="@MediaQuery.MdOrLgOrXl" DarkMode="@_preferences.DarkMode" />
		</div>
		<div class="p-1 flex-grow-1">
			<SearchForm />
		</div>
		<div class="p-1">
			<AnchorButtonsSmMdLgXl MediaQuery="@MediaQuery.MdOrLgOrXl" />
		</div>
	</div>
</div>

<div class="d-flex justify-content-end mt-1 mx-1">
	<div class="p-1">
		<ThemeToggle DarkMode="@_preferences.DarkMode" />
	</div>

	<ProfileButton />
	<div class="p-2 fs-6">
		<AnchorAndModal />
	</div>
</div>

<div class="container-fluid">
	@Body
</div>

<Footer />

@code {
	private Preferences _preferences = new();

	protected override async Task OnInitializedAsync()
	{
		ProfileService.OnChange += ProfileServiceOnOnChange;
		_preferences = await ProfileService.GetPreferences();
	}

	private void ProfileServiceOnOnChange(Preferences newPreferences)
	{
		_preferences = newPreferences;
		StateHasChanged();
	}

	public void Dispose()
	{
		ProfileService.OnChange -= ProfileServiceOnOnChange;
	}

}
